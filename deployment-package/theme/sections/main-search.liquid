{% schema %}
{
  "name": "Search Page",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "select",
      "id": "color_scheme",
      "label": "Color scheme",
      "options": [
        { "value": "1", "label": "Light" },
        { "value": "2", "label": "Dark" },
        { "value": "3", "label": "Accent" }
      ],
      "default": "1"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Search placeholder",
      "default": "WHAT ARE YOU SEEKING?"
    },
    {
      "type": "header",
      "content": "Results"
    },
    {
      "type": "text",
      "id": "results_label",
      "label": "Results label",
      "default": "Search Results"
    },
    {
      "type": "text",
      "id": "no_results_text",
      "label": "No results text",
      "default": "No results found for"
    },
    {
      "type": "header",
      "content": "Trending Section"
    },
    {
      "type": "text",
      "id": "trending_label",
      "label": "Trending label",
      "default": "Rising Now"
    },
    {
      "type": "header",
      "content": "Categories Section"
    },
    {
      "type": "text",
      "id": "categories_label",
      "label": "Categories label",
      "default": "Browse by Category"
    },
    {
      "type": "range",
      "id": "categories_count",
      "label": "Number of categories to show",
      "min": 2,
      "max": 6,
      "step": 1,
      "default": 3
    },
    {
      "type": "collection",
      "id": "featured_collection",
      "label": "Featured collection (optional)"
    }
  ],
  "blocks": [
    {
      "type": "trending_term",
      "name": "Trending Term",
      "settings": [
        {
          "type": "text",
          "id": "term",
          "label": "Search term",
          "default": "New Arrivals"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Search Page",
      "blocks": [
        { "type": "trending_term", "settings": { "term": "Oversized Web" } },
        { "type": "trending_term", "settings": { "term": "Ribbed Leggings" } },
        { "type": "trending_term", "settings": { "term": "Yoga Mats" } },
        { "type": "trending_term", "settings": { "term": "Gift Cards" } },
        { "type": "trending_term", "settings": { "term": "Essential Crew" } }
      ]
    }
  ]
}
{% endschema %}

<div class="color-scheme-{{ section.settings.color_scheme }} pt-32 min-h-screen flex flex-col">

  {%- comment -%} SEARCH INPUT {%- endcomment -%}
  <section class="px-8 max-w-5xl mx-auto w-full mb-20">
    <form action="{{ routes.search_url }}" method="get" role="search" class="relative border-b-2 border-stone-200 focus-within:border-stone-900 transition-colors">
      <button type="submit" class="absolute left-0 top-1/2 -translate-y-1/2 w-6 h-6 text-stone-400" aria-label="Search">
        {% render 'icon-search' %}
      </button>
      <input
        type="text"
        name="q"
        value="{{ search.terms | escape }}"
        placeholder="{{ section.settings.heading }}"
        class="w-full bg-transparent py-6 pl-12 text-2xl md:text-4xl font-light uppercase tracking-widest placeholder:text-stone-300 focus:outline-none text-stone-900"
        aria-label="Search"
      />
      <input type="hidden" name="type" value="product">
    </form>
  </section>

  {% if search.performed %}

    {%- comment -%} RESULTS {%- endcomment -%}
    <section class="px-8 max-w-7xl mx-auto w-full flex-grow">
      <span class="text-[10px] uppercase tracking-[0.4em] text-stone-400 font-bold block mb-12">
        {{ section.settings.results_label }} ({{ search.results_count }})
      </span>

      {% if search.results_count > 0 %}
        {% paginate search.results by 24 %}
          <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
            {% for item in search.results %}
              {% if item.object_type == 'product' %}
                {% render 'product-card', product: item %}
              {% endif %}
            {% endfor %}
          </div>

          {%- if paginate.pages > 1 -%}
            <nav class="flex justify-center items-center mt-16 gap-2" aria-label="Pagination">
              {%- if paginate.previous -%}
                <a href="{{ paginate.previous.url }}" class="px-4 py-2 border border-stone-200 text-xs uppercase tracking-widest hover:border-stone-900 transition-colors">
                  Previous
                </a>
              {%- endif -%}

              {%- for part in paginate.parts -%}
                {%- if part.is_link -%}
                  <a href="{{ part.url }}" class="w-10 h-10 flex items-center justify-center text-sm hover:bg-stone-100 transition-colors">
                    {{ part.title }}
                  </a>
                {%- else -%}
                  {%- if part.title == paginate.current_page -%}
                    <span class="w-10 h-10 flex items-center justify-center text-sm bg-stone-900 text-white">
                      {{ part.title }}
                    </span>
                  {%- else -%}
                    <span class="w-10 h-10 flex items-center justify-center text-sm text-stone-300">
                      {{ part.title }}
                    </span>
                  {%- endif -%}
                {%- endif -%}
              {%- endfor -%}

              {%- if paginate.next -%}
                <a href="{{ paginate.next.url }}" class="px-4 py-2 border border-stone-200 text-xs uppercase tracking-widest hover:border-stone-900 transition-colors">
                  Next
                </a>
              {%- endif -%}
            </nav>
          {%- endif -%}
        {% endpaginate %}
      {% else %}
        <div class="text-center py-20 text-stone-400 text-sm uppercase tracking-widest">
          {{ section.settings.no_results_text }} "{{ search.terms }}"
        </div>
      {% endif %}
    </section>

  {% else %}

    {%- comment -%} TRENDING TERMS {%- endcomment -%}
    {% if section.blocks.size > 0 %}
      <section class="px-8 max-w-7xl mx-auto w-full mb-32">
        {% if section.settings.trending_label != blank %}
          <div class="flex items-center gap-2 mb-8 text-stone-400">
            {% render 'icon-trending-up' %}
            <span class="text-[10px] uppercase tracking-[0.4em] font-bold">{{ section.settings.trending_label }}</span>
          </div>
        {% endif %}
        <div class="flex flex-wrap gap-4">
          {% for block in section.blocks %}
            {% if block.settings.term != blank %}
              <a
                href="{{ routes.search_url }}?q={{ block.settings.term | url_encode }}&type=product"
                class="px-8 py-3 border border-stone-200 text-[10px] uppercase tracking-[0.2em] font-bold hover:bg-stone-900 hover:text-white hover:border-stone-900 transition-all"
                {{ block.shopify_attributes }}
              >
                {{ block.settings.term }}
              </a>
            {% endif %}
          {% endfor %}
        </div>
      </section>
    {% endif %}

    {%- comment -%} BROWSE BY CATEGORY {%- endcomment -%}
    <section class="flex-grow bg-stone-50 py-24 border-t border-stone-100">
      <div class="px-8 max-w-7xl mx-auto w-full">
        {% if section.settings.categories_label != blank %}
          <span class="text-[10px] uppercase tracking-[0.4em] text-stone-400 font-bold block mb-12">{{ section.settings.categories_label }}</span>
        {% endif %}
        <div class="grid md:grid-cols-3 gap-8">
          {%- if section.settings.featured_collection != blank -%}
            {%- assign browse_collections = section.settings.featured_collection.products | map: 'collections' | uniq -%}
          {%- endif -%}

          {% for collection in collections limit: section.settings.categories_count %}
            <a href="{{ collection.url }}" class="group relative aspect-video overflow-hidden">
              {% if collection.image %}
                {{ collection.image | image_url: width: 800 | image_tag: class: 'w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-700 group-hover:scale-105', loading: 'lazy' }}
              {% else %}
                {{ 'collection-1' | placeholder_svg_tag: 'w-full h-full object-cover grayscale group-hover:grayscale-0' }}
              {% endif %}
              <div class="absolute inset-0 bg-black/30 flex items-center justify-center">
                <span class="text-white text-xl font-light tracking-[0.3em] uppercase group-hover:underline underline-offset-8 decoration-1">{{ collection.title }}</span>
              </div>
            </a>
          {% endfor %}
        </div>
      </div>
    </section>

  {% endif %}

</div>
