{% schema %}
{
  "name": "Product Page",
  "settings": [
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "select",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "none",
      "options": [
        { "value": "none", "label": "Default" },
        { "value": "color-scheme-1", "label": "Scheme 1 (Light)" },
        { "value": "color-scheme-2", "label": "Scheme 2 (Dark)" },
        { "value": "color-scheme-3", "label": "Scheme 3 (Accent)" }
      ],
      "info": "Applies background and button colors from Theme Settings > Color Schemes"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "gallery_layout",
      "label": "Gallery layout",
      "default": "stacked",
      "options": [
        { "value": "stacked", "label": "Stacked" },
        { "value": "slider", "label": "Slider" },
        { "value": "grid", "label": "Grid (2 columns)" }
      ]
    },
    {
      "type": "checkbox",
      "id": "enable_zoom",
      "label": "Enable image zoom",
      "default": true
    },
    {
      "type": "header",
      "content": "Product Info"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show vendor",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_sku",
      "label": "Show SKU",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_share_buttons",
      "label": "Show share buttons",
      "default": true
    },
    {
      "type": "header",
      "content": "Inventory"
    },
    {
      "type": "checkbox",
      "id": "show_stock_level",
      "label": "Show stock level",
      "default": false
    },
    {
      "type": "range",
      "id": "low_stock_threshold",
      "label": "Low stock threshold",
      "min": 1,
      "max": 20,
      "default": 5
    },
    {
      "type": "header",
      "content": "Actions"
    },
    {
      "type": "checkbox",
      "id": "enable_ajax_cart",
      "label": "Add to cart without page reload",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_quantity_selector",
      "label": "Show quantity selector",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "accordion",
      "name": "Accordion Item",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Details"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content"
        },
        {
          "type": "select",
          "id": "icon",
          "label": "Icon",
          "default": "none",
          "options": [
            { "value": "none", "label": "None" },
            { "value": "box", "label": "Box (shipping)" },
            { "value": "ruler", "label": "Ruler (sizing)" },
            { "value": "leaf", "label": "Leaf (materials)" },
            { "value": "heart", "label": "Heart (care)" }
          ]
        }
      ]
    },
    {
      "type": "trust_badges",
      "name": "Trust Badges",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_shipping",
          "label": "Show free shipping badge",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "show_returns",
          "label": "Show returns badge",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "show_secure",
          "label": "Show secure checkout badge",
          "default": true
        }
      ]
    },
    {
      "type": "related_products",
      "name": "Related Products",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "You May Also Like"
        },
        {
          "type": "range",
          "id": "products_to_show",
          "label": "Products to show",
          "min": 2,
          "max": 8,
          "default": 4
        }
      ]
    }
  ]
}
{% endschema %}

{%- liquid
  assign current_variant = product.selected_or_first_available_variant
-%}

{%- comment -%} Product JSON for JavaScript {%- endcomment -%}
<script type="application/json" id="ProductJson-{{ product.id }}">
  {{ product | json }}
</script>

<div
  class="pt-24 md:pt-32 pb-16 md:pb-24 px-4 md:px-8 max-w-7xl mx-auto min-h-screen {% if section.settings.color_scheme != 'none' %}{{ section.settings.color_scheme }}{% endif %}"
  data-product-form
  data-product-id="{{ product.id }}"
>
  <div class="grid md:grid-cols-2 gap-8 md:gap-16">
    
    {%- comment -%} LEFT: GALLERY {%- endcomment -%}
    <div class="space-y-4">
      {%- if product.media.size > 0 -%}
        {%- for media in product.media -%}
          <div class="aspect-[3/4] bg-stone-100 overflow-hidden rounded-[2px] {% if section.settings.enable_zoom %}cursor-zoom-in{% endif %}">
            {%- if forloop.first -%}
              {{ media | image_url: width: 1000 | image_tag: 
                class: 'w-full h-full object-cover', 
                loading: 'eager',
                data-product-main-image: true
              }}
            {%- else -%}
              {{ media | image_url: width: 1000 | image_tag: 
                class: 'w-full h-full object-cover', 
                loading: 'lazy'
              }}
            {%- endif -%}
          </div>
        {%- endfor -%}
      {%- else -%}
        <div class="aspect-[3/4] bg-stone-100 flex items-center justify-center">
          {{ 'product-1' | placeholder_svg_tag: 'w-1/2 h-1/2 text-stone-300' }}
        </div>
      {%- endif -%}
    </div>

    {%- comment -%} RIGHT: DETAILS {%- endcomment -%}
    <div class="md:sticky md:top-32 md:self-start">
      
      {%- comment -%} Header {%- endcomment -%}
      <div class="mb-6 md:mb-8 border-b border-stone-100 pb-6 md:pb-8">
        {%- if section.settings.show_vendor and product.vendor -%}
          <span class="text-[10px] uppercase tracking-[0.4em] text-stone-400 font-bold block mb-2">{{ product.vendor }}</span>
        {%- else -%}
          <span class="text-[10px] uppercase tracking-[0.4em] text-stone-400 font-bold block mb-2">{{ product.type }}</span>
        {%- endif -%}
        
        <h1 class="text-2xl md:text-3xl font-serif italic text-stone-900 mb-4">{{ product.title }}</h1>
        
        {%- comment -%} Price with compare-at {%- endcomment -%}
        <div class="flex items-center gap-3 mb-4">
          <span 
            class="text-xl font-light {% if current_variant.compare_at_price > current_variant.price %}text-red-600{% else %}text-stone-600{% endif %}"
            data-product-price
          >
            {{ current_variant.price | money }}
          </span>
          
          {%- if current_variant.compare_at_price > current_variant.price -%}
            <span class="text-lg text-stone-400 line-through" data-compare-price>
              {{ current_variant.compare_at_price | money }}
            </span>
            <span class="text-xs uppercase tracking-widest font-bold text-red-600 bg-red-50 px-2 py-1">Sale</span>
          {%- else -%}
            <span class="text-lg text-stone-400 line-through hidden" data-compare-price></span>
          {%- endif -%}
        </div>
        
        {%- comment -%} Stock Status {%- endcomment -%}
        {%- if section.settings.show_stock_level -%}
          <div class="text-sm" data-stock-status>
            {%- if current_variant.available -%}
              {%- if current_variant.inventory_management and current_variant.inventory_quantity <= section.settings.low_stock_threshold and current_variant.inventory_quantity > 0 -%}
                <span class="text-amber-600">Only {{ current_variant.inventory_quantity }} left</span>
              {%- else -%}
                <span class="text-green-600">In Stock</span>
              {%- endif -%}
            {%- else -%}
              <span class="text-red-600">Out of Stock</span>
            {%- endif -%}
          </div>
        {%- endif -%}
        
        {%- if section.settings.show_sku and current_variant.sku -%}
          <p class="text-xs text-stone-400 mt-2">SKU: {{ current_variant.sku }}</p>
        {%- endif -%}
        
        <div class="prose prose-stone text-sm text-stone-500 leading-relaxed mt-4">
          {{ product.description }}
        </div>
      </div>

      {%- comment -%} Product Form {%- endcomment -%}
      {% form 'product', product, data-product-form-inner: true %}
        <input type="hidden" name="id" value="{{ current_variant.id }}">
        
        {%- comment -%} Variant Picker {%- endcomment -%}
        {%- unless product.has_only_default_variant -%}
          <div class="mb-8">
            {% render 'variant-picker', product: product %}
          </div>
        {%- endunless -%}

        {%- comment -%} Quantity Selector {%- endcomment -%}
        {%- if section.settings.show_quantity_selector -%}
          <div class="mb-8">
            <label class="text-[10px] uppercase tracking-widest font-bold text-stone-400 block mb-4">Quantity</label>
            <div class="flex items-center gap-4 max-w-[140px]">
              <button 
                type="button"
                data-quantity-minus
                class="w-10 h-10 border border-stone-200 flex items-center justify-center hover:border-stone-900 transition-colors text-stone-500 hover:text-stone-900"
                aria-label="Decrease quantity"
              >
                <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path d="M5 12h14"/>
                </svg>
              </button>
              <input 
                type="number" 
                name="quantity" 
                value="1" 
                min="1" 
                data-quantity-input
                class="w-12 text-center border-0 focus:ring-0 text-lg font-medium"
                aria-label="Quantity"
              >
              <button 
                type="button"
                data-quantity-plus
                class="w-10 h-10 border border-stone-200 flex items-center justify-center hover:border-stone-900 transition-colors text-stone-500 hover:text-stone-900"
                aria-label="Increase quantity"
              >
                <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path d="M12 5v14M5 12h14"/>
                </svg>
              </button>
            </div>
          </div>
        {%- endif -%}

        {%- comment -%} Actions {%- endcomment -%}
        <div class="flex gap-4">
          <button
            type="submit"
            data-add-to-cart
            class="flex-grow py-4 text-[10px] tracking-[0.4em] font-black uppercase transition-colors shadow-xl disabled:opacity-50 disabled:cursor-not-allowed"
            style="background-color: var(--color-button, #1c1917); color: var(--color-button-text, #ffffff);"
            {% unless current_variant.available %}disabled{% endunless %}
          >
            <span data-add-to-cart-text>
              {%- if current_variant.available -%}
                Add to Cart
              {%- else -%}
                Sold Out
              {%- endif -%}
            </span>
          </button>
          {% render 'wishlist-button', product: product %}
        </div>
      {% endform %}

      {%- comment -%} Accordion Blocks {%- endcomment -%}
      {%- assign accordion_blocks = section.blocks | where: "type", "accordion" -%}
      {%- if accordion_blocks.size > 0 -%}
        <div class="mt-12 space-y-4">
          {%- for block in accordion_blocks -%}
            <details class="group border-b border-stone-100 pb-4" {{ block.shopify_attributes }}>
              <summary class="flex justify-between items-center cursor-pointer list-none py-2 text-[10px] uppercase tracking-[0.2em] font-bold text-stone-500 hover:text-stone-900 transition-colors">
                {{ block.settings.heading }}
                <span class="block w-4 h-4 relative">
                  <span class="absolute top-1/2 left-0 w-full h-px bg-current transition-transform group-open:rotate-180"></span>
                  <span class="absolute top-1/2 left-0 w-full h-px bg-current rotate-90 transition-transform group-open:rotate-180"></span>
                </span>
              </summary>
              <div class="text-sm text-stone-500 leading-relaxed pt-4">
                {{ block.settings.content }}
              </div>
            </details>
          {%- endfor -%}
        </div>
      {%- endif -%}

      {%- comment -%} Trust Badges Block {%- endcomment -%}
      {%- for block in section.blocks -%}
        {%- if block.type == 'trust_badges' -%}
          <div class="mt-8 pt-8 border-t border-stone-100 grid grid-cols-3 gap-4 text-center" {{ block.shopify_attributes }}>
            {%- if block.settings.show_shipping -%}
              <div class="flex flex-col items-center gap-2">
                <svg class="w-5 h-5 text-stone-400" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 18.75a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 01-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0H6.375c-.621 0-1.125-.504-1.125-1.125v0c0-.621.504-1.125 1.125-1.125H20.25M2.25 6h1.5m0 0h13.5m-13.5 0v7.5m13.5-7.5v7.5m0-7.5h1.5m-1.5 0v7.5m0 0h-13.5"/></svg>
                <span class="text-[9px] uppercase tracking-widest font-bold text-stone-500">Free Shipping</span>
              </div>
            {%- endif -%}
            {%- if block.settings.show_returns -%}
              <div class="flex flex-col items-center gap-2">
                <svg class="w-5 h-5 text-stone-400" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3"/></svg>
                <span class="text-[9px] uppercase tracking-widest font-bold text-stone-500">Easy Returns</span>
              </div>
            {%- endif -%}
            {%- if block.settings.show_secure -%}
              <div class="flex flex-col items-center gap-2">
                <svg class="w-5 h-5 text-stone-400" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z"/></svg>
                <span class="text-[9px] uppercase tracking-widest font-bold text-stone-500">Secure Checkout</span>
              </div>
            {%- endif -%}
          </div>
        {%- endif -%}
      {%- endfor -%}
      
      {%- comment -%} Share Buttons {%- endcomment -%}
      {%- if section.settings.show_share_buttons -%}
        <div class="mt-8 pt-8 border-t border-stone-100">
          <div class="flex items-center gap-4">
            <span class="text-[10px] uppercase tracking-widest font-bold text-stone-400">Share</span>
            <a href="https://www.facebook.com/sharer.php?u={{ shop.url }}{{ product.url }}" target="_blank" rel="noopener" class="text-stone-400 hover:text-stone-900 transition-colors" aria-label="Share on Facebook">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg>
            </a>
            <a href="https://twitter.com/intent/tweet?text={{ product.title | url_encode }}&url={{ shop.url }}{{ product.url }}" target="_blank" rel="noopener" class="text-stone-400 hover:text-stone-900 transition-colors" aria-label="Share on Twitter">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z"/></svg>
            </a>
            <a href="mailto:?subject={{ product.title | url_encode }}&body={{ shop.url }}{{ product.url }}" class="text-stone-400 hover:text-stone-900 transition-colors" aria-label="Share via Email">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><path d="M22 6l-10 7L2 6"/></svg>
            </a>
          </div>
        </div>
      {%- endif -%}
    </div>
  </div>
</div>

{%- comment -%} Related Products Block {%- endcomment -%}
{%- for block in section.blocks -%}
  {%- if block.type == 'related_products' -%}
    <div class="px-4 md:px-8 max-w-7xl mx-auto pb-16 md:pb-24" {{ block.shopify_attributes }}>
      {% if block.settings.heading != blank %}
        <h2 class="text-[11px] uppercase tracking-[0.4em] text-stone-400 font-black mb-8 text-center">{{ block.settings.heading }}</h2>
      {% endif %}
      <div class="grid grid-cols-2 md:grid-cols-{{ block.settings.products_to_show | at_most: 4 }} gap-4 md:gap-8">
        {%- for rec in product.collections.first.products limit: block.settings.products_to_show -%}
          {%- unless rec.id == product.id -%}
            {% render 'product-card', product: rec %}
          {%- endunless -%}
        {%- endfor -%}
      </div>
    </div>
  {%- endif -%}
{%- endfor -%}

{%- comment -%} Load Product Form JS {%- endcomment -%}
<script src="{{ 'product-form.js' | asset_url }}" defer></script>

{%- comment -%} Set AJAX cart flag for JS {%- endcomment -%}
{%- if section.settings.enable_ajax_cart -%}
  <script>
    window.theme = window.theme || {};
    window.theme.ajaxCart = true;
    window.theme.moneyFormat = {{ shop.money_format | json }};
  </script>
{%- endif -%}

