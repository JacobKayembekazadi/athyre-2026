{%- comment -%}
  JSON-LD Structured Data Snippet
  Renders appropriate JSON-LD based on template type.
  Include in theme.liquid head section after content_for_header.
{%- endcomment -%}

{%- case template.name -%}
  {%- when 'index' -%}
    {%- comment -%} Homepage: Organization + WebSite schema {%- endcomment -%}
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": {{ shop.name | json }},
      "url": {{ shop.url | json }},
      "logo": {%- if settings.logo -%}{{ settings.logo | image_url: width: 600 | prepend: 'https:' | json }}{%- else -%}""{%- endif -%},
      "sameAs": [
        {%- if settings.social_instagram_link != blank -%}{{ settings.social_instagram_link | json }}{%- endif -%}
        {%- if settings.social_facebook_link != blank -%},{{ settings.social_facebook_link | json }}{%- endif -%}
        {%- if settings.social_twitter_link != blank -%},{{ settings.social_twitter_link | json }}{%- endif -%}
        {%- if settings.social_pinterest_link != blank -%},{{ settings.social_pinterest_link | json }}{%- endif -%}
      ],
      "contactPoint": {
        "@type": "ContactPoint",
        "telephone": {{ shop.phone | json }},
        "contactType": "customer service"
      }
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": {{ shop.name | json }},
      "url": {{ shop.url | json }},
      "potentialAction": {
        "@type": "SearchAction",
        "target": {{ shop.url | append: '/search?q={search_term_string}' | json }},
        "query-input": "required name=search_term_string"
      }
    }
    </script>

  {%- when 'product' -%}
    {%- comment -%} Product page schema {%- endcomment -%}
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Product",
      "name": {{ product.title | json }},
      "url": {{ canonical_url | json }},
      "image": [
        {%- for image in product.images limit: 5 -%}
          {{ image | image_url: width: 1000 | prepend: 'https:' | json }}{% unless forloop.last %},{% endunless %}
        {%- endfor -%}
      ],
      "description": {{ product.description | strip_html | truncate: 500 | json }},
      "sku": {{ product.selected_or_first_available_variant.sku | json }},
      "brand": {
        "@type": "Brand",
        "name": {{ product.vendor | json }}
      },
      "offers": {
        "@type": "Offer",
        "url": {{ canonical_url | json }},
        "priceCurrency": {{ cart.currency.iso_code | json }},
        "price": {{ product.selected_or_first_available_variant.price | divided_by: 100.0 | json }},
        "availability": "https://schema.org/{% if product.selected_or_first_available_variant.available %}InStock{% else %}OutOfStock{% endif %}",
        "seller": {
          "@type": "Organization",
          "name": {{ shop.name | json }}
        }
      }
      {%- if product.metafields.reviews.rating.value -%}
      ,"aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": {{ product.metafields.reviews.rating.value.rating | json }},
        "reviewCount": {{ product.metafields.reviews.rating_count | json }}
      }
      {%- endif -%}
    }
    </script>

  {%- when 'collection' -%}
    {%- comment -%} Collection page schema {%- endcomment -%}
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "CollectionPage",
      "name": {{ collection.title | json }},
      "url": {{ canonical_url | json }},
      "description": {{ collection.description | strip_html | truncate: 500 | json }}
    }
    </script>

  {%- when 'article' -%}
    {%- comment -%} Blog article schema {%- endcomment -%}
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BlogPosting",
      "headline": {{ article.title | json }},
      "url": {{ canonical_url | json }},
      "image": {%- if article.image -%}{{ article.image | image_url: width: 1200 | prepend: 'https:' | json }}{%- else -%}""{%- endif -%},
      "datePublished": {{ article.published_at | date: '%Y-%m-%dT%H:%M:%S%z' | json }},
      "dateModified": {{ article.updated_at | date: '%Y-%m-%dT%H:%M:%S%z' | json }},
      "author": {
        "@type": "Person",
        "name": {{ article.author | json }}
      },
      "publisher": {
        "@type": "Organization",
        "name": {{ shop.name | json }},
        "logo": {
          "@type": "ImageObject",
          "url": {%- if settings.logo -%}{{ settings.logo | image_url: width: 600 | prepend: 'https:' | json }}{%- else -%}""{%- endif -%}
        }
      },
      "description": {{ article.excerpt | default: article.content | strip_html | truncate: 500 | json }}
    }
    </script>
{%- endcase -%}

{%- comment -%} Breadcrumb schema for all pages except homepage {%- endcomment -%}
{%- unless template.name == 'index' -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": {{ shop.url | json }}
    }
    {%- case template.name -%}
      {%- when 'product' -%}
        {%- if collection -%}
        ,{
          "@type": "ListItem",
          "position": 2,
          "name": {{ collection.title | json }},
          "item": {{ collection.url | prepend: shop.url | json }}
        }
        ,{
          "@type": "ListItem",
          "position": 3,
          "name": {{ product.title | json }},
          "item": {{ canonical_url | json }}
        }
        {%- else -%}
        ,{
          "@type": "ListItem",
          "position": 2,
          "name": {{ product.title | json }},
          "item": {{ canonical_url | json }}
        }
        {%- endif -%}
      {%- when 'collection' -%}
        ,{
          "@type": "ListItem",
          "position": 2,
          "name": {{ collection.title | json }},
          "item": {{ canonical_url | json }}
        }
      {%- when 'article' -%}
        ,{
          "@type": "ListItem",
          "position": 2,
          "name": {{ blog.title | json }},
          "item": {{ blog.url | prepend: shop.url | json }}
        }
        ,{
          "@type": "ListItem",
          "position": 3,
          "name": {{ article.title | json }},
          "item": {{ canonical_url | json }}
        }
      {%- when 'page' -%}
        ,{
          "@type": "ListItem",
          "position": 2,
          "name": {{ page.title | json }},
          "item": {{ canonical_url | json }}
        }
    {%- endcase -%}
  ]
}
</script>
{%- endunless -%}
